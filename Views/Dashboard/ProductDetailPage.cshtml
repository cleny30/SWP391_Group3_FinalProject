@model SWP391_Group3_FinalProject.Models.Product

@{
    ViewData["Title"] = "ProductDetailPage";
    Layout = "~/Views/Shared/_Layout_Dashboard.cshtml";
}

<div class="body-wrapper">
    <div class="container">
        <div class="container">
            <h1 class="Header">PRODUCTS MANAGEMENT</h1>
            <div class="tabs">
                <div class="tabby-tab">
                    <input type="radio" id="tab-1" name="tabby-tabs" checked>
                    <label for="tab-1" class="tabby-tablabel">PRODUCT INFORMATION</label>
                    <div class="tabby-content">
                        <!-- Product Info here-->
                        <div id="" class="col-12">
                            <div class="col-12" style="text-align: center; padding: 10px;">
                                <h1 class="Title">PRODUCT INFORMATION</h1>

                            </div>
                            <form method="POST" action="/Dashboard/EditProduct"  enctype="multipart/form-data">
                                <div class="row">

                                    <div class="form-group" style="text-align: center;">
                                        <button type="button" id="removeReadonlyButton"
                                                class="btn btn-outline-primary m-1">
                                            Enable Editing
                                        </button>
                                        <h3 id="messagehidden" style="color:red;">
                                            The table is currently
                                            readonly, clicked the above button to enable editing
                                        </h3>
                                    </div>

                                    <!--Product Name -->
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label class="label" for="pro_name">Product Name</label>
                                            <input type="text" class="form-control" name="pro_name"
                                                   id="pro_name" value="@Model.pro_name" readonly>

                                            <input type="hidden" class="form-control" name="pro_id"
                                                   id="pro_name" value="@Model.pro_id" readonly>
                                            <!--Get Value from Database-->
                                        </div>
                                    </div>
                                    <!--Product Name -->
                                    <!--Price -->
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label class="label" for="pro_price">Price</label>
                                            <input type="number" class="form-control" name="pro_price"
                                                   id="pro_price" value="@Model.pro_price" readonly> 
                                            <!--Get Value from Database-->
                                        </div>
                                    </div>
                                    <!--Price -->
                                    <!--Price -->
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label class="label" for="pro_price">Discount Percent</label>
                                            <input type="number" class="form-control" name="discount"
                                                   id="pro_discount" value="@Model.discount" readonly> 
                                            <!--Get Value from Database-->
                                        </div>
                                    </div>
                                    <!--Price -->
                                    <!--Categories -->
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label class="label" for="category">Category</label>

                                            <select name="cate_id" class="form-control" id="cate_id" disabled>
                                                @foreach (var category in ViewBag.CategoryList)
                                                {
                                                    <option value="@category.cate_id" @(Model.cate_id == category.cate_id ? "selected" : "")>@category.cate_name</option>
                                                }
                                            </select>

                                        </div>
                                    </div>
                                    <!--Categories -->
                                    <!--Brands -->
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label class="label" for="brand">Brand</label>

                                            <select name="brand_id" class="form-control" id="brand_id" disabled>
                                                @foreach (var brand in ViewBag.BrandList)
                                                {
                                                    <option value="@brand.brand_id" @(Model.brand_id == brand.brand_id ? "selected" : "")>@brand.brand_name</option>
                                                }
                                            </select>

                                        </div>
                                    </div>
                                    <!--Brands -->
                                    <!--Add Images -->
                                    <div class="col-md-6 ">
                                        <h1 class="Title" style="padding: 10px;">Images List</h1>
                                        <div id="room_fileds_image">
                                            <div class="content">
                                                <!--Foreach cho hình ảnh đã có sẵn trong database theo ID của sản phẩm-->
                                                @foreach (var pictures in ViewBag.ProductImage)
                                                {
                                                    string input = pictures;

                                                    int count = 0;
                                                    string[] parts = input.Split('_');
                                                    if (parts.Length >= 2)
                                                    {
                                                        string numericPart = parts[parts.Length - 1];

                                                        // Remove the file extension, if any
                                                        int dotIndex = numericPart.LastIndexOf('.');
                                                        if (dotIndex != -1)
                                                        {
                                                            numericPart = numericPart.Substring(0, dotIndex);
                                                        }

                                                        // Try to parse the numeric part
                                                        if (int.TryParse(numericPart, out int number))
                                                        {
                                                            count = number;
                                                        }
                                                        else
                                                        {
                                                            Console.WriteLine("Numeric part is not a valid integer.");
                                                        }
                                                    }

                                                    string[] parts2 = pictures.Split('\\');
                                                    string filenameWithExtension = parts2[parts2.Length - 1];

                                                    // Remove the file extension
                                                    string[] filenameParts = filenameWithExtension.Split('.');
                                                    string filenameWithoutExtension = filenameParts[0];
                                                    int counter = 1;

                                                    <div name="PictureOrInput">
                                                    <img src="@pictures"
                                                         alt="Smiley face" class="imgStyle" width="200"
                                                             height="200" title="Original Image" id="imgPicture" />  <!--Src lấy trên database-->

                                                    <div class="hidden" style="display: none;">
                                                        <!--Input File-->
                                                            <input class="form-control" type="file" name="@filenameWithoutExtension" id="fileInput">
                                                            <input class="form-control" type="hidden" name="Image_ID" id="fileInput" value="@count">
                                                            <!--Input File-->
                                                        <label style="color: red;">
                                                            Input a new file to change
                                                            the image
                                                        </label>
                                                    </div>
                                                    </div>
                                                    counter++;
                                                }
                                                <!--Foreach-->
                                            </div>
                                        </div>
                                        <br>
                                        <input class="btn btn-outline-primary m-1" type="button"
                                               id="more_fieldsimage" onclick="add_fieldsImage();"
                                               value="Add new Image" style="display: none;" />
                                    </div>
                                    <div class="col-md-6 ">
                                        <h1 class="Title" style="padding: 10px;">Attribute List</h1>

                                        <!--Add Attribute-->
                                        <div id="room_fileds">
                                            <div class="content">
                                                <!--Foreach lấy trong database theo ID của sản phẩm-->
                                                @foreach (var pair in ViewBag.ProductAttribute)
                                                {
                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <label for="attname">Attribute</label>
                                                                <input class="form-control" type="text" name="feature" value="@pair.Key" id="attname" readonly>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <label for="attDes">Attribute Description</label>
                                                                <input class="form-control" type="text" name="description" value=" @pair.Value" id="attDes" readonly>
                                                            </div>
                                                        </div>
                                                    </div>
                                                }

                                                <!--Foreach-->
                                            </div>
                                        </div>
                                        <br>
                                        <input class="btn btn-outline-primary m-1" type="button"
                                               id="more_fields" onclick="add_fieldsDetails();"
                                               value="Add new Details" style="display: none;" />
                                    </div>
                                    <!--Add Attribute-->
                                    <hr style="padding: 10px; ">
                                    <!--Description -->
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label class="label" for="#">Description</label>
                                            <textarea name="pro_des" class="form-control" id="message"
                                                      cols="30" rows="10" placeholder="Description"
                                                      readonly> @Model.pro_des</textarea>
                                        </div> <!--Get Value trên Database-->
                                    </div>
                                    <!--Description -->

                                    <div class="col-md-12">
                                        <div class="form-group"
                                             style="text-align: center; padding-top: 20px;">
                                            <input type="submit" value="Submit" class="btn btn-primary"
                                                   id="hiddenButton" style="display: none;">
                                            <button id="resetButton" style="display: none;"
                                                    class="btn btn-secondary">
                                                Reset
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <!-- Product Info here-->




                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    var room = 0;
    function add_fieldsDetails() {
        room++;
        var objTo = document.getElementById('room_fileds')
        var divtest = document.createElement("div");
        divtest.innerHTML = `
    <div class="row">
        <div class="col-md-6">
            <div class="form-group">
                <label for="attname">Attribute</label>
                <input class="form-control" type="text" name="feature">
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
                <label for="attDes">Attribute Description</label>
                <input class="form-control" type="text" name="description">
            </div>
        </div>
    </div>
    `;;

        objTo.appendChild(divtest)
    }
</script>
<script>

    var room_image = 0;
    var img = 1;
    function add_fieldsImage() {
        room_image++;
        img++;
        var objTo = document.getElementById('room_fileds_image')
        var divtest = document.createElement("div");
        divtest.innerHTML = ' <label>Image ' + room_image + '</label> <input class="form-control" type="file" name="imgFile"> ';

        objTo.appendChild(divtest)
    }
</script>

<script>
    document.getElementById('removeReadonlyButton').addEventListener('click', function () {
        document.getElementById('pro_name').removeAttribute('readonly');
        document.getElementById('pro_price').removeAttribute('readonly');
        document.getElementById('message').removeAttribute('readonly');
        var attnameElement = document.getElementById('attname');
        var attDesElement = document.getElementById('attDes');

        if (attnameElement && attDesElement) {
            attnameElement.removeAttribute('readonly');
            attDesElement.removeAttribute('readonly');
        } else {
            console.error("Elements with IDs 'attname' and 'attDes' not found.");
        }
        document.getElementById('cate_id').removeAttribute('disabled');
        document.getElementById('brand_id').removeAttribute('disabled');
        document.getElementById('pro_discount').removeAttribute('readonly');
        var hiddenButton = document.getElementById('hiddenButton');
        if (hiddenButton.style.display === 'none') {
            hiddenButton.style.display = 'inline';
        }
        var hiddenButton = document.getElementById('resetButton');
        if (hiddenButton.style.display === 'none') {
            hiddenButton.style.display = 'inline';
        }

        var hiddenButton = document.getElementById('more_fieldsimage');
        if (hiddenButton.style.display === 'none') {
            hiddenButton.style.display = 'inline';
        }

        var hiddenButton = document.getElementById('more_fields');
        if (hiddenButton.style.display === 'none') {
            hiddenButton.style.display = 'inline';
        }

        var hiddenButton = document.getElementById('messagehidden');
        hiddenButton.style.display = 'none';


    });
</script>

<script>
    document.getElementById('resetButton').addEventListener('click', function () {
        location.reload();
    });
</script>

<script>
    var showButtons = document.getElementById('removeReadonlyButton');
    var hiddenDivs = document.querySelectorAll('.hidden');
    var divsVisible = false;

    showButtons.addEventListener('click', function () {
        hiddenDivs.forEach(function (div) {
            div.style.display = 'block';
        });
    });
</script>


